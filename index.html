<html ng-app="DOECaptainsApp">
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular-cookies.min.js"></script>
    <script src="https://cdn.firebase.com/js/client/2.2.4/firebase.js"></script>
    <script src="https://cdn.firebase.com/libs/angularfire/1.1.2/angularfire.min.js"></script>
    <script>
    //https://www.firebase.com/docs/web/libraries/angular/quickstart.html
    var app = angular.module("DOECaptainsApp", ["firebase","ngCookies"]);
    
    app.controller("DOECaptainsController", function($scope, $firebaseObject) {
      var rounddata = new Firebase("https://doecaptains.firebaseio.com/rounds");
      $scope.round = $firebaseObject(rounddata.push({teams:["a"]}));//.$bindTo($scope,$scope.round);
      $scope.save = function(){
        $scope.round.$save();
      };
      $scope.newteam = function(teams){
        console.log($scope.round.teams);
        teams["New Team "+Math.floor(Math.random()*10000)]=[
          {id:0,pos:"Player"}
        ];
      };
      
      var memberdata = new Firebase("https://doecaptains.firebaseio.com/members");
      $scope.members = $firebaseObject(memberdata);
    });
    </script>
    <style>
      table{width:100%;text-align:center;}
      td{background-color:#ccc;padding:2em;}
      td.mid{width:5px;background-color:black;padding:0;}
      td b{font-size:2em;}
      td.buzzed{background-color:#ffc;}
      td.correct{background-color:#ffc;}
      td.incorrect{background-color:#ffc;}
    </style>
  </head>
  <body ng-controller="DOECaptainsController as dq">
    <div id="roundsettings">
      <button ng-click="save();">Save</button>
      <div>Name: <input ng-model="round.name"></div>
      <div>Details: <textarea ng-model="round.details"></textarea></div>
      <div>Round: <input ng-model="round.round"></div>
      <div>Teams:
        <div><button ng-click="newteam(round.teams)">Add Team</button></div>
        <div ng-repeat="(teamname,team) in round.teams">
          <input ng-model="teamname" />
          <div ng-repeat="(orderpos,player) in team">
            {{orderpos}} <input ng-model="player.pos" />: <select ng-model="player.name"><option ng-repeat="(id,memberdata) in members" value="{{id}}">{{memberdata.name}}</option></select>
          </div>
        </div>
      </div>
    </div>
    <div id="qhistorydisplay">
    <!--Here is an editable display of all the questions that have been read so far. Who(s) buzzed, what they(s) did, bonus, etc. -->
    <!--Though we love the new input system, you will always be able to enter data this way too. 
      THE NEW INPUT SYSTEM SHOULD JUST BE A LAYER OVER THIS DROPDOWN-BOX SYSTEM.-->
    
    </div>
    <div id="teamdisplay">
    </div>

    <!--script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script-->
<script>
/*
    //Use JSON cookie storage. https://github.com/samyk/evercookie :D
    //And always be sending stuff back to the server, every question and every direct-edit.


    //backspace goes back
    //5v5 for normal and freeforall mode for speed rounds (don't bother with the complex stuff)
    n1 vs n2 vs n3 vs n4 vs ... vs nm


    var keyBindings = {};
    function bindKeyToPlayer(key, player){
      keyBindings[key] = player;
    }
    $(window).keypress(function(e){
      if(e.which == 32);
      else if(e.which == 13);
      else{
        var ch = String.fromCharCode(e.which);
      }
    });

    function Player(){
      
    }
    function Team(name,players){
      this.name = name;
      this.points = 0;
      this.players = players;
      this.buzzingAllowed = true;
      this.reset = function(){
        this.buzzingAllowed = true;
        
      };
      this.buzz = function(key){
        for(var i = 0; i < players.length; i++)
          if(players[i].key == key)return i;
        return -1;
      };
    }

    var NormalGame = { //Point values and everything should be here
      "start": function(key){
        if(key=="space")return "tossup";
        else return false;
      },
      "tossup": function(key){
        //key will be a s d f j k l ;
      },
      "interrupting": function(key){
        for(var i = 0; i < teams.length; i++){
          var index = teams[i].buzz(key);
          if(index !== -1)
            1;
        }
      },
      "regular buzzing": function(key){
      
      },
    };


    var teams = [
      new Team("A Team",[
        {
          person:{
            id:123,
            name:"Aiyappa Kodendera",
          },
          key:"a",
          title:"Player 3",
        },
        {
          person:{
            id:41,
            name:"Catherine Wang",
          },
          key:"s",
          title:"Player 2",
        },
        {
          person:{
            id:443,
            name:"Eric Xia",
          },
          key:"d",
          title:"Captain",
        },
        {
          person:{
            id:0,
            name:"Clive Chan",
          },
          key:"f",
          title:"Player 1",
        },
      ]),
      new Team("B Team",[
        {
          person:{
            id:723,
            name:"AK",
          },
          key:"a",
          title:"Player 1",
        },
        {
          person:{
            id:552,
            name:"CW",
          },
          key:"s",
          title:"Captain",
        },
        {
          person:{
            id:989,
            name:"EX",
          },
          key:"d",
          title:"Player 2",
        },
        {
          person:{
            id:34,
            name:"CC",
          },
          key:"f",
          title:"Player 3",
        },
      ]),
    ];

    //for()
    $("#buttons");

    //var buzzesAllowed
    //freeForAll?
    //var positions = ["Player 1","Captain","Player 2","Player 3","Player 4"];
    //var teams = ["gfdsa","hjkl;"]; //Standard 5v5 - indices correspond with var positions
    //var teams = ["a","s","d","f","g","h","j","k","l",";"];
    var maintable = $(".team");
    (function(){
      for(var t = 0; t < teams.length; t++){
        if(t%2 == 0){
          var row = document.createElement("tr");
          for(var i = teams[t].length - 1; i >= 0; i--){
            var player = document.createElement("td");
            player.innerHTML = "<b>"+teams[t][i]+"</b><br>"+positions[i];
            player.id = "t"+t+"p"+i;
            row.appendChild(player);
          }
          maintable.append(row);
        }
        else{
          var rows = maintable.find("tr");
          var row = rows[rows.length-1];
          var mid = document.createElement("td");
          mid.className="mid";
          row.appendChild(mid);
          for(var i = 0; i < teams[t].length; i++){
            var player = document.createElement("td");
            player.innerHTML = "<b>"+teams[t][i]+"</b><br>"+positions[i];
            player.id = "t"+t+"p"+i;
            row.appendChild(player);
          }
        }
      }
    })();
    window.onkeypress=function(e){
      if(!e)var e=window.event;
      if(e.keyCode == 32){//space resets
        buzzed = false;
        document.getElementsByClassName("buzzed")[0].className="";
      }
      console.log(e);
      if(buzzed === true){
        if(e.keyCode == 13){
          
        }
      }
      if(buzzed === false){
        for(var t = 0; t < teams.length; t++)
          for(var i = 0; i < teams[t].length; i++)
            if(e.keyCode == teams[t].charCodeAt(i)){
              console.log("Team "+(t+1)+", "+positions[i]);
              document.getElementById("t"+t+"p"+i).className = "buzzed";
              buzzed = true;
            }
      }
    }*/
    </script>
  </body>
</html>